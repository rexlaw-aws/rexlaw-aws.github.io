
<!doctype html>
<html lang="zh-TW" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../iam/">
      
      
        <link rel="next" href="../multitenancy/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.15">
    
    
      
        <title>Pod 安全 - EKS最佳實踐指南</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-VQGL8B2FH8"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-VQGL8B2FH8",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-VQGL8B2FH8",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pod" class="md-skip">
          跳轉到
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="頁首">
    <a href="../../../" title="EKS最佳實踐指南" class="md-header__button md-logo" aria-label="EKS最佳實踐指南" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EKS最佳實踐指南
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pod 安全
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="選擇語言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../../../security/docs/pods/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../../ko/security/docs/pods/" hreflang="ko" class="md-select__link">
              한국어
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../../zh/security/docs/pods/" hreflang="zh" class="md-select__link">
              中文（简体）
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="zh-TW" class="md-select__link">
              中文（繁體）
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜尋" placeholder="搜尋" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="搜尋">
        
        <button type="reset" class="md-search__icon md-icon" title="清除" aria-label="清除" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜尋引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws/aws-eks-best-practices" title="前往倉庫" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-eks-best-practices
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="導覽列" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../" title="EKS最佳實踐指南" class="md-nav__button md-logo" aria-label="EKS最佳實踐指南" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    EKS最佳實踐指南
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws/aws-eks-best-practices" title="前往倉庫" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-eks-best-practices
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    指南
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            指南
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    簡介
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    安全
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            安全
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首頁
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    身份和訪問管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Pod 安全
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Pod 安全
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目錄">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目錄
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 功能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux 功能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      節點授權
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pod 安全解決方案
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pod 安全解決方案">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod-psp" class="md-nav__link">
    <span class="md-ellipsis">
      Pod 安全策略 (PSP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_2" class="md-nav__link">
    <span class="md-ellipsis">
      遷移到新的 Pod 安全解決方案
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pac" class="md-nav__link">
    <span class="md-ellipsis">
      策略即代碼 (PAC)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod-pss-pod-psa" class="md-nav__link">
    <span class="md-ellipsis">
      Pod 安全標準 (PSS) 和 Pod 安全准入 (PSA)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pod 安全標準 (PSS) 和 Pod 安全准入 (PSA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod_3" class="md-nav__link">
    <span class="md-ellipsis">
      現有 Pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      豁免
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_4" class="md-nav__link">
    <span class="md-ellipsis">
      在策略即代碼和 Pod 安全標準之間進行選擇
    </span>
  </a>
  
    <nav class="md-nav" aria-label="在策略即代碼和 Pod 安全標準之間進行選擇">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod_5" class="md-nav__link">
    <span class="md-ellipsis">
      策略即代碼 (與 Pod 安全標準相比)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_6" class="md-nav__link">
    <span class="md-ellipsis">
      Pod 安全准入 (與策略即代碼相比)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      總結
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      建議
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建議">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod-psa" class="md-nav__link">
    <span class="md-ellipsis">
      使用多個 Pod 安全准入 (PSA) 模式以獲得更好的用戶體驗
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      限制可以以特權方式運行的容器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root" class="md-nav__link">
    <span class="md-ellipsis">
      不要在容器中以 root 身份運行進程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      永遠不要在容器中運行 Docker 或掛載套接字
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hostpath-hostpath" class="md-nav__link">
    <span class="md-ellipsis">
      限制使用 hostPath 或如果需要 hostPath,限制可以使用的前綴並將卷配置為只讀
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dos" class="md-nav__link">
    <span class="md-ellipsis">
      為每個容器設置請求和限制,以避免資源爭用和 DoS 攻擊
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      不允許特權升級
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serviceaccount" class="md-nav__link">
    <span class="md-ellipsis">
      禁用 ServiceAccount 令牌掛載
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      禁用服務發現
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      配置您的映像以具有只讀根文件系統
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      工具和資源
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multitenancy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多租戶
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../detective/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    偵查控制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    網絡安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    數據加密和密鑰管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runtime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    運行時安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hosts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基礎設施安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compliance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    監管合規性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../incidents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    事故響應和取證
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    映像安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiaccount/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多帳戶策略
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    叢集自動擴展
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            叢集自動擴展
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../karpenter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Karpenter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cluster-autoscaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    叢集自動擴展器
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    可靠性
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            可靠性
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reliability/docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首頁
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reliability/docs/application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    應用程式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reliability/docs/controlplane/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    控制平面
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reliability/docs/dataplane/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    數據平面
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Windows 容器
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Windows 容器
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/ami/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AMI 管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/gmsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows 容器的 gMSA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/hardening/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows Server 強化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    掃描 Windows 映像
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/licensing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows 版本和許可
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    日誌記錄
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    監控 Windows 容器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows 網絡
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/oom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    內存和系統管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/patching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基礎設施管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/scheduling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    調度
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows 容器的 Pod 安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    存儲選項
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    網絡
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            網絡
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首頁
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/subnets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VPC 和子網考量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/vpc-cni/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Amazon VPC CNI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/ip-optimization-strategies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    優化 IP 地址利用率
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/ipv6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    運行 IPv6 叢集
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/custom-networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自訂網路
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/prefix-mode/index_linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux 的前綴模式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/prefix-mode/index_windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows 的前綴模式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/sgpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    每個 Pod 的安全組
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/loadbalancing/loadbalancing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    負載均衡
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    網絡性能問題監控
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    可擴展性
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            可擴展性
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首頁
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/control-plane/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    控制平面
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/data-plane/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    數據平面
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/cluster-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    叢集服務
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/workloads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    工作負載
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/scaling_theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    擴展背後的理論
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/kcp_monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    控制平面監控
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/node_efficiency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    節點效率和擴展
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/kubernetes_slos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes SLO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/quotas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    已知限制和服務配額
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../upgrades/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    叢集升級
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    成本優化
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            成本優化
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cfm_framework/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    雲端財務管理框架
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_compute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    計算
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    網絡
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    存儲
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    可觀察性
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目錄">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目錄
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 功能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux 功能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      節點授權
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pod 安全解決方案
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pod 安全解決方案">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod-psp" class="md-nav__link">
    <span class="md-ellipsis">
      Pod 安全策略 (PSP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_2" class="md-nav__link">
    <span class="md-ellipsis">
      遷移到新的 Pod 安全解決方案
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pac" class="md-nav__link">
    <span class="md-ellipsis">
      策略即代碼 (PAC)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod-pss-pod-psa" class="md-nav__link">
    <span class="md-ellipsis">
      Pod 安全標準 (PSS) 和 Pod 安全准入 (PSA)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pod 安全標準 (PSS) 和 Pod 安全准入 (PSA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod_3" class="md-nav__link">
    <span class="md-ellipsis">
      現有 Pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      豁免
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_4" class="md-nav__link">
    <span class="md-ellipsis">
      在策略即代碼和 Pod 安全標準之間進行選擇
    </span>
  </a>
  
    <nav class="md-nav" aria-label="在策略即代碼和 Pod 安全標準之間進行選擇">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod_5" class="md-nav__link">
    <span class="md-ellipsis">
      策略即代碼 (與 Pod 安全標準相比)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_6" class="md-nav__link">
    <span class="md-ellipsis">
      Pod 安全准入 (與策略即代碼相比)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      總結
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      建議
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建議">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod-psa" class="md-nav__link">
    <span class="md-ellipsis">
      使用多個 Pod 安全准入 (PSA) 模式以獲得更好的用戶體驗
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      限制可以以特權方式運行的容器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root" class="md-nav__link">
    <span class="md-ellipsis">
      不要在容器中以 root 身份運行進程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      永遠不要在容器中運行 Docker 或掛載套接字
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hostpath-hostpath" class="md-nav__link">
    <span class="md-ellipsis">
      限制使用 hostPath 或如果需要 hostPath,限制可以使用的前綴並將卷配置為只讀
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dos" class="md-nav__link">
    <span class="md-ellipsis">
      為每個容器設置請求和限制,以避免資源爭用和 DoS 攻擊
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      不允許特權升級
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serviceaccount" class="md-nav__link">
    <span class="md-ellipsis">
      禁用 ServiceAccount 令牌掛載
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      禁用服務發現
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      配置您的映像以具有只讀根文件系統
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      工具和資源
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="pod">Pod 安全性<a class="headerlink" href="#pod" title="Permanent link">&para;</a></h1>
<p>Pod 規格包含各種不同的屬性,可以增強或減弱您的整體安全態勢。 作為 Kubernetes 從業者,您的主要關注應該是防止在容器中運行的進程逃脫容器運行時的隔離邊界,並獲得對底層主機的訪問權限。</p>
<h2 id="linux">Linux 功能<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h2>
<p>在容器內運行的進程默認情況下在 [Linux] 根用戶的上下文中運行。 儘管容器運行時分配給容器的一組 Linux 功能部分限制了根用戶在容器內的操作,但這些默認權限可能允許攻擊者升級其權限和/或訪問綁定到主機的敏感信息,包括 Secrets 和 ConfigMaps。 以下是分配給容器的默認功能列表。 有關每個功能的更多信息,請參見 <a href="http://man7.org/linux/man-pages/man7/capabilities.7.html">http://man7.org/linux/man-pages/man7/capabilities.7.html</a>。</p>
<p><code>CAP_AUDIT_WRITE, CAP_CHOWN, CAP_DAC_OVERRIDE, CAP_FOWNER, CAP_FSETID, CAP_KILL, CAP_MKNOD, CAP_NET_BIND_SERVICE, CAP_NET_RAW, CAP_SETGID, CAP_SETUID, CAP_SETFCAP, CAP_SETPCAP, CAP_SYS_CHROOT</code></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
</div>
<p>EC2 和 Fargate pod 默認分配了上述功能。此外,只能從 Fargate pod 中刪除 Linux 功能。</p>
<p>以特權方式運行的 Pod 繼承了主機上根用戶關聯的所有 Linux 功能。 如果可能,應該避免這樣做。</p>
<h3 id="_1">節點授權<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>所有 Kubernetes 工作節點都使用一種稱為 <a href="https://kubernetes.io/docs/reference/access-authn-authz/node/">節點授權</a> 的授權模式。 節點授權授權所有來自 kubelet 的 API 請求,並允許節點執行以下操作:</p>
<p>讀取操作:</p>
<ul>
<li>服務</li>
<li>端點</li>
<li>節點</li>
<li>Pod</li>
<li>與 kubelet 節點綁定的 secret、configmap、持久卷聲明和持久卷</li>
</ul>
<p>寫入操作:</p>
<ul>
<li>節點和節點狀態(啟用 <code>NodeRestriction</code> 准入插件以限制 kubelet 修改其自己的節點)</li>
<li>Pod 和 Pod 狀態(啟用 <code>NodeRestriction</code> 准入插件以限制 kubelet 修改綁定到自己的 Pod)</li>
<li>事件</li>
</ul>
<p>身份驗證相關操作:</p>
<ul>
<li>對 CertificateSigningRequest (CSR) API 的讀/寫訪問權限,用於 TLS 引導</li>
<li>創建 TokenReview 和 SubjectAccessReview 的能力,用於委託的身份驗證/授權檢查</li>
</ul>
<p>EKS 使用 <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction">節點限制准入控制器</a> ,它只允許節點修改有限的節點屬性集和綁定到節點的 Pod 對象。 然而,攻擊者如果設法獲得對主機的訪問權限,仍然能夠從 Kubernetes API 中獲取有關環境的敏感信息,這可能允許他們在集群內橫向移動。</p>
<h2 id="pod_1">Pod 安全解決方案<a class="headerlink" href="#pod_1" title="Permanent link">&para;</a></h2>
<h3 id="pod-psp">Pod 安全策略 (PSP)<a class="headerlink" href="#pod-psp" title="Permanent link">&para;</a></h3>
<p>過去,<a href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/">Pod 安全策略 (PSP)</a> 資源用於指定 Pod 必須滿足的一組要求,然後才能創建。 從 Kubernetes 版本 1.21 開始,PSP 已被棄用。 它們計劃在 Kubernetes 版本 1.25 中被刪除。</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
</div>
<p><a href="https://kubernetes.io/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/">PSP 在 Kubernetes 版本 1.21 中被棄用</a>。 您將有到版本 1.25 或大約 2 年的時間過渡到替代方案。 這 <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-auth/2579-psp-replacement/README.md#motivation">文檔</a> 解釋了這一棄用的動機。</p>
<h3 id="pod_2">遷移到新的 Pod 安全解決方案<a class="headerlink" href="#pod_2" title="Permanent link">&para;</a></h3>
<p>由於 PSP 已在 Kubernetes v1.25 中被刪除,集群管理員和運營商必須替換這些安全控制。 有兩種解決方案可以滿足這一需求:</p>
<ul>
<li>Kubernetes 生態系統中的策略即代碼 (PAC) 解決方案</li>
<li>Kubernetes <a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/">Pod 安全標準 (PSS)</a></li>
</ul>
<p>PAC 和 PSS 解決方案都可以與 PSP 共存;它們可以在 PSP 被刪除之前在集群中使用。 這有助於在從 PSP 遷移時的採用。 在考慮從 PSP 遷移到 PSS 時,請參閱此 <a href="https://kubernetes.io/docs/tasks/configure-pod-container/migrate-from-psp/">文檔</a>。</p>
<p>Kyverno,下面概述的 PAC 解決方案之一,在從 PSP 遷移到其解決方案時提供了具體的指導,包括類似的策略、功能比較和遷移過程。 有關使用 Kyverno 遷移到 Pod 安全准入 (PSA) 的其他信息和指導已發布在 AWS 博客 <a href="https://aws.amazon.com/blogs/containers/managing-pod-security-on-amazon-eks-with-kyverno/">上</a>。</p>
<h3 id="pac">策略即代碼 (PAC)<a class="headerlink" href="#pac" title="Permanent link">&para;</a></h3>
<p>策略即代碼 (PAC) 解決方案提供了護欄,通過規定的和自動化的控制來指導集群用戶,並防止不想要的行為。 PAC 使用 <a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/">Kubernetes 動態准入控制器</a> 來攔截 Kubernetes API 服務器請求流,通過 webhook 調用,並根據以代碼形式編寫和存儲的策略來變異和驗證請求有效載荷。 變異和驗證發生在 API 服務器請求導致對集群的更改之前。 PAC 解決方案使用策略來匹配和操作 API 服務器請求有效載荷,基於分類法和值。</p>
<p>Kubernetes 生態系統中有幾種開源的 PAC 解決方案。 這些解決方案不是 Kubernetes 項目的一部分;它們源自 Kubernetes 生態系統。 一些 PAC 解決方案如下所列。</p>
<ul>
<li><a href="https://open-policy-agent.github.io/gatekeeper/website/docs/">OPA/Gatekeeper</a></li>
<li><a href="https://www.openpolicyagent.org/">Open Policy Agent (OPA)</a></li>
<li><a href="https://kyverno.io/">Kyverno</a></li>
<li><a href="https://www.kubewarden.io/">Kubewarden</a></li>
<li><a href="https://www.jspolicy.com/">jsPolicy</a></li>
</ul>
<p>有關 PAC 解決方案以及如何幫助您選擇適合您需求的解決方案的更多信息,請參見下面的鏈接。</p>
<ul>
<li><a href="https://aws.amazon.com/blogs/containers/policy-based-countermeasures-for-kubernetes-part-1/">Kubernetes 的基於策略的對策 - 第 1 部分</a></li>
<li><a href="https://aws.amazon.com/blogs/containers/policy-based-countermeasures-for-kubernetes-part-2/">Kubernetes 的基於策略的對策 - 第 2 部分</a></li>
</ul>
<h3 id="pod-pss-pod-psa">Pod 安全標準 (PSS) 和 Pod 安全准入 (PSA)<a class="headerlink" href="#pod-pss-pod-psa" title="Permanent link">&para;</a></h3>
<p>為了應對 PSP 棄用以及持續控制 Pod 安全的需求,Kubernetes <a href="https://github.com/kubernetes/community/tree/master/sig-auth">Auth Special Interest Group</a> 創建了 <a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/">Pod 安全標準 (PSS)</a> 和 <a href="https://kubernetes.io/docs/concepts/security/pod-security-admission/">Pod 安全准入 (PSA)</a>。 PSA 工作包括一個 <a href="https://github.com/kubernetes/pod-security-admission#pod-security-admission">准入控制器 webhook 項目</a> ,它實現了 PSS 中定義的控制。 這種准入控制器方法類似於 PAC 解決方案中使用的方法。</p>
<p>根據 Kubernetes 文檔,PSS <em>"定義了三種不同的策略,廣泛覆蓋安全範圍。 這些策略是累積的,範圍從高度寬鬆到高度限制性。"</em></p>
<p>這些策略定義如下:</p>
<ul>
<li>
<p><strong>特權:</strong> 無限制(不安全)策略,提供最寬鬆的權限級別。 此策略允許已知的特權升級。 這是沒有策略的情況。 這對於日誌代理、CNI、存儲驅動程序和其他需要特權訪問的系統範圍應用程序很有用。</p>
</li>
<li>
<p><strong>基線:</strong> 最小限制性策略,可防止已知的特權升級。 允許默認(最小指定)的 Pod 配置。 基線策略禁止使用 hostNetwork、hostPID、hostIPC、hostPath、hostPort,以及添加 Linux 功能的能力,以及其他幾個限制。</p>
</li>
<li>
<p><strong>受限:</strong> 高度受限的策略,遵循當前 Pod 強化最佳實踐。 此策略繼承自基線,並添加了更多限制,例如無法以 root 或 root 組運行。 受限策略可能會影響應用程序的功能。 它們主要針對運行關鍵安全應用程序。</p>
</li>
</ul>
<p>這些策略定義了 <a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/#profile-details">Pod 執行配置文件</a>,分為三個特權與受限訪問級別。</p>
<p>為了實施 PSS 定義的控制,PSA 以三種模式運行:</p>
<ul>
<li>
<p><strong>enforce:</strong> 策略違規將導致 Pod 被拒絕。</p>
</li>
<li>
<p><strong>audit:</strong> 策略違規將觸發在審核日誌中添加審核註釋,但否則允許。</p>
</li>
<li>
<p><strong>warn:</strong> 策略違規將觸發用戶可見的警告,但否則允許。</p>
</li>
</ul>
<p>這些模式和限制級別(配置文件)在 Kubernetes 命名空間級別使用標籤進行配置,如下例所示。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-test</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/enforce</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
</code></pre></div>
<p>單獨使用這些操作模式會有不同的響應,從而產生不同的用戶體驗。 <em>enforce</em> 模式將阻止違反配置的限制級別的 Pod 被創建。 但是,在這種模式下,創建 Pod 的 Kubernetes 對象(如 Deployment)將不會被阻止應用到集群,即使其中的 podSpec 違反了應用的 PSS。 在這種情況下,Deployment 將被應用,而 Pod(s) 將被阻止被應用。</p>
<p>這是一種困難的用戶體驗,因為成功應用的 Deployment 對象掩蓋了失敗的 Pod 創建。 違反 podSpec 的 Pod 將不會被創建。 使用 <code>kubectl get deploy &lt;DEPLOYMENT_NAME&gt; -oyaml</code> 檢查 Deployment 資源將暴露來自失敗 Pod(s) 的 <code>.status.conditions</code> 元素中的消息,如下所示。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nn">...</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nt">status</span><span class="p">:</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="nt">conditions</span><span class="p">:</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">lastTransitionTime</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2022-01-20T01:02:08Z&quot;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">      </span><span class="nt">lastUpdateTime</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2022-01-20T01:02:08Z&quot;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;pods</span><span class="nv"> </span><span class="s">&quot;test-688f68dc87-tw587&quot;</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">forbidden:</span><span class="nv"> </span><span class="s">violates</span><span class="nv"> </span><span class="s">PodSecurity</span><span class="nv"> </span><span class="s">&quot;restricted:latest&quot;:</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">        </span><span class="s">allowPrivilegeEscalation</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">false</span><span class="nv"> </span><span class="s">(container</span><span class="nv"> </span><span class="s">&quot;test&quot;</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">securityContext.allowPrivilegeEscalation=false),</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">        </span><span class="s">unrestricted</span><span class="nv"> </span><span class="s">capabilities</span><span class="nv"> </span><span class="s">(container</span><span class="nv"> </span><span class="s">&quot;test&quot;</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">securityContext.capabilities.drop=[&quot;ALL&quot;]),</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">        </span><span class="s">runAsNonRoot</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">true</span><span class="nv"> </span><span class="s">(pod</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">container</span><span class="nv"> </span><span class="s">&quot;test&quot;</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">securityContext.runAsNonRoot=true),</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">        </span><span class="s">seccompProfile</span><span class="nv"> </span><span class="s">(pod</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">container</span><span class="nv"> </span><span class="s">&quot;test&quot;</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">securityContext.seccompProfile.type</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">        </span><span class="s">to</span><span class="nv"> </span><span class="s">&quot;RuntimeDefault&quot;</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">&quot;Localhost&quot;)&#39;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">      </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FailedCreate</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">      </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;True&quot;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReplicaFailure</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="nn">...</span>
</code></pre></div>
<p>在 <em>audit</em> 和 <em>warn</em> 模式下,Pod 限制不會阻止違反的 Pod 被創建和啟動。 但是,在這些模式下,當 Pod 以及創建 Pod 的對象包含違反的 podSpec 時,會觸發審核日誌事件上的審核註釋和對 API 服務器客戶端(如 <em>kubectl</em>)的警告。 下面可以看到一個 <code>kubectl</code> <em>Warning</em> 消息。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Warning:<span class="w"> </span>would<span class="w"> </span>violate<span class="w"> </span>PodSecurity<span class="w"> </span><span class="s2">&quot;restricted:latest&quot;</span>:<span class="w"> </span>allowPrivilegeEscalation<span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="o">(</span>container<span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"> </span>must<span class="w"> </span><span class="nb">set</span><span class="w"> </span>securityContext.allowPrivilegeEscalation<span class="o">=</span><span class="nb">false</span><span class="o">)</span>,<span class="w"> </span>unrestricted<span class="w"> </span>capabilities<span class="w"> </span><span class="o">(</span>container<span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"> </span>must<span class="w"> </span><span class="nb">set</span><span class="w"> </span>securityContext.capabilities.drop<span class="o">=[</span><span class="s2">&quot;ALL&quot;</span><span class="o">])</span>,<span class="w"> </span>runAsNonRoot<span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">(</span>pod<span class="w"> </span>or<span class="w"> </span>container<span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"> </span>must<span class="w"> </span><span class="nb">set</span><span class="w"> </span>securityContext.runAsNonRoot<span class="o">=</span><span class="nb">true</span><span class="o">)</span>,<span class="w"> </span>seccompProfile<span class="w"> </span><span class="o">(</span>pod<span class="w"> </span>or<span class="w"> </span>container<span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"> </span>must<span class="w"> </span><span class="nb">set</span><span class="w"> </span>securityContext.seccompProfile.type<span class="w"> </span>to<span class="w"> </span><span class="s2">&quot;RuntimeDefault&quot;</span><span class="w"> </span>or<span class="w"> </span><span class="s2">&quot;Localhost&quot;</span><span class="o">)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>deployment.apps/test<span class="w"> </span>created
</code></pre></div>
<p>PSA <em>audit</em> 和 <em>warn</em> 模式在不會對集群操作產生負面影響的情況下引入 PSS 很有用。</p>
<p>PSA 操作模式不是互斥的,可以以累積的方式使用。 如下所示,多個模式可以在單個命名空間中配置。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-test</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/audit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/enforce</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/warn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
</code></pre></div>
<p>在上面的例子中,當應用 Deployments 時,提供了用戶友好的警告和審核註釋,同時在 Pod 級別也提供了違規的強制執行。 事實上,多個 PSA 標籤可以使用不同的配置文件級別,如下所示。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-test</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/enforce</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">baseline</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/warn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
</code></pre></div>
<p>在上面的例子中,PSA 被配置為允許創建所有滿足 <em>baseline</em> 配置文件級別的 Pod,然後在 Pod(和創建 Pod 的對象)違反 <em>restricted</em> 配置文件級別時發出警告。 這是一種有用的方法,可以確定從 <em>baseline</em> 到 <em>restricted</em> 配置文件時可能產生的影響。</p>
<h4 id="pod_3">現有 Pod<a class="headerlink" href="#pod_3" title="Permanent link">&para;</a></h4>
<p>如果將使用更嚴格的 PSS 配置文件的命名空間修改了現有的 Pod,<em>audit</em> 和 <em>warn</em> 模式將產生適當的消息;但是 <em>enforce</em> 模式不會刪除 Pod。 可以看到下面的警告消息。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Warning:<span class="w"> </span>existing<span class="w"> </span>pods<span class="w"> </span><span class="k">in</span><span class="w"> </span>namespace<span class="w"> </span><span class="s2">&quot;policy-test&quot;</span><span class="w"> </span>violate<span class="w"> </span>the<span class="w"> </span>new<span class="w"> </span>PodSecurity<span class="w"> </span>enforce<span class="w"> </span>level<span class="w"> </span><span class="s2">&quot;restricted:latest&quot;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>Warning:<span class="w"> </span>test-688f68dc87-htm8x:<span class="w"> </span>allowPrivilegeEscalation<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>false,<span class="w"> </span>unrestricted<span class="w"> </span>capabilities,<span class="w"> </span>runAsNonRoot<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>true,<span class="w"> </span>seccompProfile
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>namespace/policy-test<span class="w"> </span>configured
</code></pre></div>
<h4 id="_2">豁免<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<p>PSA 使用 <em>Exemptions</em> 來排除對本應適用的 Pod 違規的強制執行。 這些豁免列舉如下。</p>
<ul>
<li>
<p><strong>用戶名:</strong> 忽略來自具有豁免的經過身份驗證(或模擬)的用戶名的請求。</p>
</li>
<li>
<p><strong>RuntimeClassNames:</strong> 忽略指定豁免運行時類名的 Pod 和工作負載資源。</p>
</li>
<li>
<p><strong>命名空間:</strong> 忽略豁免命名空間中的 Pod 和工作負載資源。</p>
</li>
</ul>
<p>這些豁免靜態地應用在 <a href="https://kubernetes.io/docs/tasks/configure-pod-container/enforce-standards-admission-controller/#configure-the-admission-controller">PSA 准入控制器配置</a> 中,作為 API 服務器配置的一部分。</p>
<p>在 <em>Validating Webhook</em> 實現中,豁免可以在 Kubernetes <a href="https://github.com/kubernetes/pod-security-admission/blob/master/webhook/manifests/20-configmap.yaml">ConfigMap</a> 資源中配置,該資源作為卷掛載到 <a href="https://github.com/kubernetes/pod-security-admission/blob/master/webhook/manifests/50-deployment.yaml">pod-security-webhook</a> 容器中。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-security-webhook</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-security-webhook</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="nt">data</span><span class="p">:</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">  </span><span class="nt">podsecurityconfiguration.yaml</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="no">apiVersion: pod-security.admission.config.k8s.io/v1</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="no">kind: PodSecurityConfiguration</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="no">defaults:</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">      </span><span class="no">enforce: &quot;restricted&quot;</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">      </span><span class="no">enforce-version: &quot;latest&quot;</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">      </span><span class="no">audit: &quot;restricted&quot;</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">      </span><span class="no">audit-version: &quot;latest&quot;</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">      </span><span class="no">warn: &quot;restricted&quot;</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">      </span><span class="no">warn-version: &quot;latest&quot;</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">    </span><span class="no">exemptions:</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">      </span><span class="no"># Array of authenticated usernames to exempt.</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">      </span><span class="no">usernames: []</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">      </span><span class="no"># Array of runtime class names to exempt.</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">      </span><span class="no">runtimeClasses: []</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">      </span><span class="no"># Array of namespaces to exempt.</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">      </span><span class="no">namespaces: [&quot;kube-system&quot;,&quot;policy-test1&quot;]</span>
</code></pre></div>
<p>如上面的 ConfigMap YAML 所示,集群範圍的默認 PSS 級別已設置為所有 PSA 模式(<em>audit</em>、<em>enforce</em> 和 <em>warn</em>)的 <em>restricted</em>。 這影響所有命名空間,除了被豁免的命名空間: <code>namespaces: ["kube-system","policy-test1"]</code>。 此外,在下面看到的 <em>ValidatingWebhookConfiguration</em> 資源中,<em>pod-security-webhook</em> 命名空間也被豁免於配置的 PSS。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nn">...</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nt">webhooks</span><span class="p">:</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="c1"># Audit annotations will be prefixed with this name</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pod-security-webhook.kubernetes.io&quot;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="c1"># Fail-closed admission webhooks can present operational challenges.</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="c1"># You may want to consider using a failure policy of Ignore, but should </span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="c1"># consider the security tradeoffs.</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="nt">failurePolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fail</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="nt">namespaceSelector</span><span class="p">:</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">      </span><span class="c1"># Exempt the webhook itself to avoid a circular dependency.</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">      </span><span class="nt">matchExpressions</span><span class="p">:</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/metadata.name</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NotIn</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">          </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;pod-security-webhook&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="nn">...</span>
</code></pre></div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
</div>
<p>Pod 安全准入在 Kubernetes v1.25 中升級為穩定版本。 如果您想在默認情況下啟用 Pod 安全准入功能之前使用它,您需要安裝動態准入控制器(變異 webhook)。 安裝和配置 webhook 的說明可以在 <a href="https://github.com/kubernetes/pod-security-admission/tree/master/webhook">這裡</a> 找到。</p>
<h3 id="pod_4">在策略即代碼和 Pod 安全標準之間進行選擇<a class="headerlink" href="#pod_4" title="Permanent link">&para;</a></h3>
<p>Pod 安全標準 (PSS) 的開發是為了取代 Pod 安全策略 (PSP),提供一個內置於 Kubernetes 中的解決方案,而不需要 Kubernetes 生態系統中的解決方案。 也就是說,策略即代碼 (PAC) 解決方案要靈活得多。</p>
<p>以下 Pros 和 Cons 列表旨在幫助您做出更明智的 Pod 安全解決方案決定。</p>
<h4 id="pod_5">策略即代碼 (與 Pod 安全標準相比)<a class="headerlink" href="#pod_5" title="Permanent link">&para;</a></h4>
<p>優點:</p>
<ul>
<li>更靈活,更細粒度(如果需要,可以到資源屬性)</li>
<li>不僅關注 Pod,可以用於不同的資源和操作</li>
<li>不僅在命名空間級別應用</li>
<li>比 Pod 安全標準更成熟</li>
<li>決策可以基於 API 服務器請求有效載荷中的任何內容,以及現有的集群資源和外部數據(取決於解決方案)</li>
<li>支持在驗證之前變異 API 服務器請求(取決於解決方案)</li>
<li>可以生成補充性策略和 Kubernetes 資源(取決於解決方案 - 從 Pod 策略,Kyverno 可以 <a href="https://kyverno.io/docs/writing-policies/autogen/">自動生成</a> 適用於更高級別控制器(如 Deployment)的策略。 Kyverno 還可以通過使用 <a href="https://kyverno.io/docs/writing-policies/generate/">生成規則</a> 在創建新資源或源更新時生成其他 Kubernetes 資源。)</li>
<li>可用於左移,進入 CICD 管道,在調用 Kubernetes API 服務器之前(取決於解決方案)</li>
<li>可用於實現不一定與安全相關的行為,如最佳實踐、組織標準等</li>
<li>可用於非 Kubernetes 用例(取決於解決方案)</li>
<li>由於靈活性,用戶體驗可以根據用戶的需求進行調整</li>
</ul>
<p>缺點:</p>
<ul>
<li>不內置於 Kubernetes</li>
<li>學習、配置和支持更加複雜</li>
<li>策略編寫可能需要新的技能/語言/功能</li>
</ul>
<h4 id="pod_6">Pod 安全准入 (與策略即代碼相比)<a class="headerlink" href="#pod_6" title="Permanent link">&para;</a></h4>
<p>優點:</p>
<ul>
<li>內置於 Kubernetes</li>
<li>配置更簡單</li>
<li>不需要使用新語言或編寫策略</li>
</ul>
<p>缺點:</p>
<ul>
<li>不如策略即代碼靈活或細粒度</li>
<li>只有 3 個限制級別</li>
<li>主要關注 Pod</li>
</ul>
<h4 id="_3">總結<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<p>如果您目前沒有 Pod 安全解決方案,除了 PSP 之外,並且您所需的 Pod 安全態勢符合 Pod 安全標準 (PSS) 定義的模型,那麼採用 PSS 可能是一條更容易的路徑,而不是採用策略即代碼解決方案。 但是,如果您的 Pod 安全態勢不符合 PSS 模型,或者您設想添加超出 PSS 定義的其他控制,那麼策略即代碼解決方案可能更適合您。</p>
<h2 id="_4">建議<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="pod-psa">使用多個 Pod 安全准入 (PSA) 模式以獲得更好的用戶體驗<a class="headerlink" href="#pod-psa" title="Permanent link">&para;</a></h3>
<p>如前所述,PSA <em>enforce</em> 模式可防止違反 PSS 的 Pod 被應用,但不會阻止更高級別的控制器(如 Deployment)。 事實上,Deployment 將成功應用,而沒有任何表明 Pod 失敗的跡象。 雖然您可以使用 <code>kubectl</code> 檢查 Deployment 對象,並發現來自 PSA 的失敗 Pod 消息,但用戶體驗可能會更好。 為了獲得更好的用戶體驗,應該使用多個 PSA 模式(審核、強制、警告)。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy-test</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/audit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/enforce</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="nt">pod-security.kubernetes.io/warn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restricted</span>
</code></pre></div>
<p>在上面的例子中,使用了 <em>enforce</em> 模式,當試圖將包含 PSS 違規的 podSpec 的 Deployment 清單應用到 Kubernetes API 服務器時,Deployment 將成功應用,但 Pod 將不會。 而且,由於啟用了 <em>audit</em> 和 <em>warn</em> 模式,API 服務器客戶端將收到警告消息,API 服務器審核日誌事件也將被註釋。</p>
<h3 id="_5">限制可以以特權方式運行的容器<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>如前所述,以特權方式運行的容器繼承了主機上根用戶分配的所有 Linux 功能。 很少有容器需要這種特權才能正常運行。 有多種方法可用於限制容器的權限和功能。</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
</div>
<p>Fargate 是一種啟動類型,它使您能夠運行"無服務器"容器,其中 Pod 的容器在 AWS 管理的基礎設施上運行。 使用 Fargate,您無法運行特權容器或配置 Pod 使用 hostNetwork 或 hostPort。</p>
<h3 id="root">不要在容器中以 root 身份運行進程<a class="headerlink" href="#root" title="Permanent link">&para;</a></h3>
<p>所有容器默認以 root 身份運行。 如果攻擊者能夠利用應用程序中的漏洞並獲得對正在運行的容器的 shell 訪問權限,這可能會造成問題。 您可以通過多種方式緩解這種風險。 首先,通過從容器映像中刪除 shell。 其次,在 Dockerfile 中添加 USER 指令,或在 Pod 中以非 root 用戶運行容器。 Kubernetes podSpec 包括一組字段 <code>spec.securityContext</code>,可以用來指定運行應用程序的用戶和/或組。 這些字段分別是 <code>runAsUser</code> 和 <code>runAsGroup</code>。</p>
<p>為了強制在 Kubernetes podSpec 中使用 <code>spec.securityContext</code> 及其相關元素,可以添加策略即代碼或 Pod 安全標準到集群。 這些解決方案允許您編寫和/或使用可以在持久存儲到 etcd 之前驗證入站 Kubernetes API 服務器請求有效載荷的策略或配置文件。 此外,策略即代碼解決方案可以變異入站請求,在某些情況下還可以生成新的請求。</p>
<h3 id="docker">永遠不要在容器中運行 Docker 或掛載套接字<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h3>
<p>雖然這樣做可以方便地在 Docker 容器中構建/運行映像,但您基本上是放棄了對節點的完全控制權。 如果您需要在 Kubernetes 上構建容器映像,請改用 <a href="https://github.com/GoogleContainerTools/kaniko">Kaniko</a>、<a href="https://github.com/containers/buildah">buildah</a> 或 <a href="https://docs.aws.amazon.com/codebuild/latest/userguide/welcome.html">CodeBuild</a> 等構建服務。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
</div>
<p>用於 CICD 處理(如構建容器映像)的 Kubernetes 集群應與運行更一般工作負載的集群隔離。</p>
<h3 id="hostpath-hostpath">限制使用 hostPath 或如果需要 hostPath,限制可以使用的前綴並將卷配置為只讀<a class="headerlink" href="#hostpath-hostpath" title="Permanent link">&para;</a></h3>
<p><code>hostPath</code> 是一個將主機上的目錄直接掛載到容器的卷。 很少有 Pod 需要這種訪問,但如果需要,您需要注意風險。 默認情況下,以 root 身份運行的 Pod 將對 hostPath 公開的文件系統具有寫訪問權限。 這可能允許攻擊者修改 kubelet 設置、創建指向不直接由 hostPath 公開的目錄或文件(例如 /etc/shadow)的符號鏈接、安裝 ssh 密鑰、讀取掛載到主機的 secret 等惡意操作。 為了緩解 hostPath 帶來的風險,請將 <code>spec.containers.volumeMounts</code> 配置為 <code>readOnly</code>,例如:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nt">volumeMounts</span><span class="p">:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostPath-volume</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">readOnly</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">mountPath</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/host-path</span>
</code></pre></div>
<p>您還應該使用策略即代碼解決方案來限制可以使用 <code>hostPath</code> 卷的目錄,或完全防止使用 <code>hostPath</code>。 您可以使用 Pod 安全標準 <em>Baseline</em> 或 <em>Restricted</em> 策略來防止使用 <code>hostPath</code>。</p>
<p>有關特權升級危險的更多信息,請閱讀 Seth Art 的博客 <a href="https://labs.bishopfox.com/tech-blog/bad-pods-kubernetes-pod-privilege-escalation">Bad Pods: Kubernetes Pod Privilege Escalation</a>。</p>
<h3 id="dos">為每個容器設置請求和限制,以避免資源爭用和 DoS 攻擊<a class="headerlink" href="#dos" title="Permanent link">&para;</a></h3>
<p>沒有請求或限制的 Pod 可以理論上消耗節點上可用的所有資源。 隨著更多 Pod 被調度到節點上,節點可能會遇到 CPU 或內存壓力,這可能導致 Kubelet 終止或驅逐節點上的 Pod。 雖然您無法完全防止這種情況發生,但設置請求和限制將有助於最小化資源爭用,並緩解由於編寫不善而消耗過多資源的應用程序的風險。</p>
<p><code>podSpec</code> 允許您為 CPU 和內存指定請求和限制。 CPU 被視為可壓縮資源,因為它可以被過度訂閱。 內存是不可壓縮的,即不能在多個容器之間共享。</p>
<p>當您指定 <em>requests</em> 的 CPU 或內存時,您實際上是在指定容器保證獲得的 <em>內存</em> 量。 Kubernetes 會聚合 Pod 中所有容器的請求,以確定將 Pod 調度到哪個節點上。 如果容器超過請求的內存量,如果節點出現內存壓力,它可能會被終止。</p>
<p><em>Limits</em> 是容器允許消耗的最大 CPU 和內存資源,直接對應於為容器創建的 cgroup 的 <code>memory.limit_in_bytes</code> 值。 如果容器超過內存限制,它將被 OOM 殺死。 如果容器超過其 CPU 限制,它將被節流。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
</div>
<p>使用容器 <code>resources.limits</code> 時,強烈建議基於負載測試的數據驅動和準確的容器資源使用情況(即資源足跡)。 如果沒有準確和可信的資源足跡,可以將容器 <code>resources.limits.memory</code> 填充 20-30% 以上的最大值,以應對潛在的內存資源限制不準確。</p>
<p>Kubernetes 使用三種服務質量(QoS)類來優先考慮節點上運行的工作負載。 它們包括:</p>
<ul>
<li>guaranteed</li>
<li>burstable</li>
<li>best-effort</li>
</ul>
<p>如果未設置限制和請求,Pod 將配置為 <em>best-effort</em>(最低優先級)。 當內存不足時,首先殺死 best-effort Pod。 如果 Pod 中所有容器都設置了限制,或者請求和限制設置為相同的值且不等於 0,則 Pod 將配置為 <em>guaranteed</em>(最高優先級)。 保證 Pod 不會被殺死,除非它們超過配置的內存限制。 如果限制和請求配置為不同的值且不等於 0,或者 Pod 中的一個容器設置了限制而其他容器沒有或設置了不同的資源限制,則 Pod 將配置為 <em>burstable</em>(中等優先級)。 這些 Pod 有一些資源保證,但如果超過請求的內存,可能會被殺死。</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
</div>
<p>請求不會影響容器 cgroup 的 <code>memory_limit_in_bytes</code> 值;cgroup 限制設置為主機上可用的內存量。 但是,如果將請求值設置得太低,可能會導致 kubelet 在節點出現內存壓力時將 Pod 作為目標終止。</p>
<table>
<thead>
<tr>
<th style="text-align: left;">類別</th>
<th style="text-align: left;">優先級</th>
<th style="text-align: left;">條件</th>
<th style="text-align: left;">殺死條件</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Guaranteed</td>
<td style="text-align: left;">最高</td>
<td style="text-align: left;">limit = request != 0</td>
<td style="text-align: left;">只有超過內存限制</td>
</tr>
<tr>
<td style="text-align: left;">Burstable</td>
<td style="text-align: left;">中等</td>
<td style="text-align: left;">limit != request != 0</td>
<td style="text-align: left;">如果超過請求內存可能被殺死</td>
</tr>
<tr>
<td style="text-align: left;">Best-Effort</td>
<td style="text-align: left;">最低</td>
<td style="text-align: left;">limit &amp; request 未設置</td>
<td style="text-align: left;">當內存不足時首先被殺死</td>
</tr>
</tbody>
</table>
<p>有關資源 QoS 的更多信息,請參考 <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/">Kubernetes 文檔</a>。</p>
<p>您可以通過在命名空間上設置 <a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/">資源配額</a> 或創建 <a href="https://kubernetes.io/docs/concepts/policy/limit-range/">限制範圍</a> 來強制使用請求和限制。 資源配額允許您指定分配給命名空間的資源總量,例如 CPU 和 RAM。 當應用於命名空間時,它會強制您為部署到該命名空間的所有容器指定請求和限制。 相比之下,限制範圍使您可以更細粒度地控制資源分配。 使用限制範圍,您可以設置每個 Pod 或命名空間中每個容器的最小/最大 CPU 和內存資源。 您還可以使用它們來設置默認的請求/限制值(如果未提供)。</p>
<p>策略即代碼解決方案可用於強制執行請求和限制,或在創建命名空間時創建資源配額和限制範圍。</p>
<h3 id="_6">不允許特權升級<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>特權升級允許進程更改其正在運行的安全上下文。 sudo 就是一個很好的例子,二進制文件也有 SUID 或 SGID 位。 特權升級基本上是一種讓用戶以另一個用戶或組的權限執行文件的方式。 您可以通過實施一個變異策略即代碼策略來防止容器使用特權升級,該策略將 <code>allowPrivilegeEscalation</code> 設置為 <code>false</code>,或在 <code>podSpec</code> 中設置 <code>securityContext.allowPrivilegeEscalation</code>。 策略即代碼策略也可用於在檢測到不正確的設置時防止 API 服務器請求成功。 Pod 安全標準也可用於防止 Pod 使用特權升級。</p>
<h3 id="serviceaccount">禁用 ServiceAccount 令牌掛載<a class="headerlink" href="#serviceaccount" title="Permanent link">&para;</a></h3>
<p>對於不需要訪問 Kubernetes API 的 Pod,您可以禁用 Pod 規格上的 ServiceAccount 令牌自動掛載,或對使用特定 ServiceAccount 的所有 Pod 禁用。</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
</div>
<p>禁用 ServiceAccount 掛載並不能防止 Pod 訪問 Kubernetes API。 要完全阻止 Pod 訪問 Kubernetes API,您需要修改 <a href="https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html">EKS 集群端點訪問</a> 並使用 <a href="../network/#network-policy">NetworkPolicy</a> 阻止 Pod 訪問。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-no-automount</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="nt">automountServiceAccountToken</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sa-no-automount</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="nt">automountServiceAccountToken</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<h3 id="_7">禁用服務發現<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>對於不需要查找或調用集群內服務的 Pod,您可以減少提供給 Pod 的信息量。 您可以將 Pod 的 DNS 策略設置為不使用 CoreDNS,並且不將服務公開為環境變量。 有關服務鏈接的更多信息,請參見 <a href="https://kubernetes.io/docs/concepts/services-networking/service/#environment-variables">Kubernetes 文檔關於環境變量</a>。 Pod 的 DNS 策略的默認值為 "ClusterFirst",使用集群內 DNS,而非默認值 "Default" 使用底層節點的 DNS 解析。 有關 Pod DNS 策略的更多信息,請參見 <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-s-dns-policy">Kubernetes 文檔</a>。</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
</div>
<p>禁用服務鏈接和更改 Pod 的 DNS 策略並不能防止 Pod 訪問集群內 DNS 服務。 攻擊者仍然可以通過訪問集群內 DNS 服務來枚舉集群中的服務(例如: <code>dig SRV *.*.svc.cluster.local @$CLUSTER_DNS_IP</code>)。 要防止集群內服務發現,請使用 <a href="../network/#network-policy">NetworkPolicy</a> 阻止 Pod 訪問。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-no-service-info</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span><span class="nt">dnsPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Default</span><span class="w"> </span><span class="c1"># &quot;Default&quot; 不是真正的默認值</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="nt">enableServiceLinks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<h3 id="_8">配置您的映像以具有只讀根文件系統<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>配置您的映像以具有只讀根文件系統可以防止攻擊者覆寫您的應用程序使用的二進制文件。 如果您的應用程序需要寫入文件系統,請考慮寫入臨時目錄或附加和掛載卷。 您可以通過設置 Pod 的 SecurityContext 來強制執行這種行為:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nn">...</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nt">securityContext</span><span class="p">:</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="nn">...</span>
</code></pre></div>
<p>策略即代碼和 Pod 安全標準可用於強制執行此行為。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
</div>
<p>根據 <a href="https://kubernetes.io/docs/concepts/windows/intro/">Windows 容器在 Kubernetes 中</a> 的說法,<code>securityContext.readOnlyRootFilesystem</code> 不能設置為 <code>true</code>,因為寫訪問權限對於註冊表和在容器內運行的系統進程是必需的。</p>
<h2 id="_9">工具和資源<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://catalog.workshops.aws/eks-security-immersionday/en-US/3-pod-security">Amazon EKS 安全沉浸式研討會 - Pod 安全性</a></li>
<li><a href="https://github.com/open-policy-agent/gatekeeper-library">open-policy-agent/gatekeeper-library: The OPA Gatekeeper policy library</a> 一個 OPA/Gatekeeper 策略庫,可用作 PSP 的替代品。</li>
<li><a href="https://kyverno.io/policies/">Kyverno 策略庫</a></li>
<li>一些常見的 OPA 和 Kyverno <a href="https://github.com/aws/aws-eks-best-practices/tree/master/policies">策略</a>用於 EKS。</li>
<li><a href="https://aws.amazon.com/blogs/containers/policy-based-countermeasures-for-kubernetes-part-1/">基於策略的對策:第 1 部分</a></li>
<li><a href="https://aws.amazon.com/blogs/containers/policy-based-countermeasures-for-kubernetes-part-2/">基於策略的對策:第 2 部分</a></li>
<li><a href="https://appvia.github.io/psp-migration/">Pod 安全策略遷移器</a> 一個將 PSP 轉換為 OPA/Gatekeeper、KubeWarden 或 Kyverno 策略的工具</li>
<li><a href="https://www.suse.com/neuvector/">NeuVector by SUSE</a> 開源、零信任容器安全平台,提供進程和文件系統策略以及准入控制規則。</li>
</ul>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["tabs", "content.code.copy", "announce.dismiss", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u8907\u88fd", "clipboard.copy": "\u8907\u88fd", "search.result.more.one": "\u6b64\u9801\u5c1a\u6709 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.more.other": "\u6b64\u9801\u5c1a\u6709 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.none": "\u6c92\u6709\u7b26\u5408\u7684\u9805\u76ee", "search.result.one": "\u627e\u5230 1 \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.other": "\u627e\u5230 # \u500b\u7b26\u5408\u7684\u9805\u76ee", "search.result.placeholder": "\u6253\u5b57\u9032\u884c\u641c\u5c0b", "search.result.term.missing": "\u7f3a\u5c11\u5b57\u8a5e", "select.version": "\u9078\u64c7\u7248\u672c"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.bd41221c.min.js"></script>
      
    
  </body>
</html>