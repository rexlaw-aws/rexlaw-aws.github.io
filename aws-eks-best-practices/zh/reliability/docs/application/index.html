
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../controlplane/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.15">
    
    
      
        <title>应用程序 - EKS最佳实践指南</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-VQGL8B2FH8"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-VQGL8B2FH8",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-VQGL8B2FH8",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../" title="EKS最佳实践指南" class="md-header__button md-logo" aria-label="EKS最佳实践指南" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EKS最佳实践指南
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              应用程序
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../../../reliability/docs/application/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../../ko/reliability/docs/application/" hreflang="ko" class="md-select__link">
              한국어
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="zh" class="md-select__link">
              中文（简体）
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../../zh-TW/reliability/docs/application/" hreflang="zh-TW" class="md-select__link">
              中文（繁體）
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws/aws-eks-best-practices" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-eks-best-practices
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../" title="EKS最佳实践指南" class="md-nav__button md-logo" aria-label="EKS最佳实践指南" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    EKS最佳实践指南
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws/aws-eks-best-practices" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-eks-best-practices
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    指南
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            指南
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    介绍
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    安全
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            安全
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/iam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    身份和访问管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/pods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pod安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/multitenancy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多租户
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/detective/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    侦查控制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网络安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数据加密和机密管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/runtime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运行时安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/hosts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基础设施安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/compliance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    监管合规性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/incidents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    事故响应和取证
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    镜像安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/multiaccount/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多账户策略
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    集群自动扩缩
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            集群自动扩缩
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../karpenter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Karpenter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cluster-autoscaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    集群自动缩放器
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    可靠性
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            可靠性
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    应用程序
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    应用程序
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      建议
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod" class="md-nav__link">
    <span class="md-ellipsis">
      避免运行单个 Pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      运行多个副本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      在节点上调度副本
    </span>
  </a>
  
    <nav class="md-nav" aria-label="在节点上调度副本">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod_1" class="md-nav__link">
    <span class="md-ellipsis">
      使用 Pod 反亲和性规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_2" class="md-nav__link">
    <span class="md-ellipsis">
      使用 Pod 拓扑传播约束
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-metrics-server" class="md-nav__link">
    <span class="md-ellipsis">
      运行 Kubernetes Metrics Server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod-hpa" class="md-nav__link">
    <span class="md-ellipsis">
      水平 Pod 自动缩放器 (HPA)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="水平 Pod 自动缩放器 (HPA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      根据自定义或外部指标扩展应用程序
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod-vpa" class="md-nav__link">
    <span class="md-ellipsis">
      垂直 Pod 自动缩放器 (VPA)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      更新应用程序
    </span>
  </a>
  
    <nav class="md-nav" aria-label="更新应用程序">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      有一种回滚机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      使用蓝/绿部署
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      使用金丝雀部署
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      健康检查和自我修复
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      建议
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod_3" class="md-nav__link">
    <span class="md-ellipsis">
      使用存活探针删除不健康的 pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      对于启动时间较长的应用程序,使用启动探针
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      使用就绪探针检测部分不可用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      处理中断
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      建议
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod_4" class="md-nav__link">
    <span class="md-ellipsis">
      使用 Pod 中断预算保护关键工作负载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      实践混沌工程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      使用服务网格
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      服务网格
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      可观察性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      建议
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      监控您的应用程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus" class="md-nav__link">
    <span class="md-ellipsis">
      使用 Prometheus 客户端库公开应用程序指标
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      使用集中式日志记录工具收集和持久化日志
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      使用分布式跟踪系统识别瓶颈
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../controlplane/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    控制平面
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataplane/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数据平面
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Windows容器
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Windows容器
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/ami/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AMI管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/gmsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows容器的gMSA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/hardening/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows服务器强化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    扫描Windows镜像
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/licensing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows版本和许可
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    日志记录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    监控Windows容器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows网络
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/oom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内存和系统管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/patching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基础设施管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/scheduling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    调度
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows容器的Pod安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    存储选项
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    网络
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            网络
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/subnets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VPC和子网注意事项
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/vpc-cni/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Amazon VPC CNI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/ip-optimization-strategies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    优化IP地址利用率
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/ipv6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运行IPv6集群
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/custom-networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自定义网络
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/prefix-mode/index_linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux的前缀模式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/prefix-mode/index_windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows的前缀模式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/sgpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    每个Pod的安全组
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/loadbalancing/loadbalancing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    负载均衡
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网络性能问题监控
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    可扩展性
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            可扩展性
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/control-plane/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    控制平面
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/data-plane/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数据平面
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/cluster-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    集群服务
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/workloads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    工作负载
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/scaling_theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    扩展背后的理论
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/kcp_monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    控制平面监控
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/node_efficiency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    节点效率和扩展
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/kubernetes_slos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes SLO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/quotas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    已知限制和服务配额
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../upgrades/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    集群升级
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    成本优化
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            成本优化
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cfm_framework/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    云财务管理框架
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_compute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计算
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网络
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    存储
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    可观察性
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      建议
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod" class="md-nav__link">
    <span class="md-ellipsis">
      避免运行单个 Pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      运行多个副本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      在节点上调度副本
    </span>
  </a>
  
    <nav class="md-nav" aria-label="在节点上调度副本">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod_1" class="md-nav__link">
    <span class="md-ellipsis">
      使用 Pod 反亲和性规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_2" class="md-nav__link">
    <span class="md-ellipsis">
      使用 Pod 拓扑传播约束
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-metrics-server" class="md-nav__link">
    <span class="md-ellipsis">
      运行 Kubernetes Metrics Server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod-hpa" class="md-nav__link">
    <span class="md-ellipsis">
      水平 Pod 自动缩放器 (HPA)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="水平 Pod 自动缩放器 (HPA)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      根据自定义或外部指标扩展应用程序
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pod-vpa" class="md-nav__link">
    <span class="md-ellipsis">
      垂直 Pod 自动缩放器 (VPA)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      更新应用程序
    </span>
  </a>
  
    <nav class="md-nav" aria-label="更新应用程序">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      有一种回滚机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      使用蓝/绿部署
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      使用金丝雀部署
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      健康检查和自我修复
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      建议
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod_3" class="md-nav__link">
    <span class="md-ellipsis">
      使用存活探针删除不健康的 pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      对于启动时间较长的应用程序,使用启动探针
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      使用就绪探针检测部分不可用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      处理中断
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      建议
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod_4" class="md-nav__link">
    <span class="md-ellipsis">
      使用 Pod 中断预算保护关键工作负载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      实践混沌工程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      使用服务网格
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      服务网格
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      可观察性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      建议
    </span>
  </a>
  
    <nav class="md-nav" aria-label="建议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      监控您的应用程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus" class="md-nav__link">
    <span class="md-ellipsis">
      使用 Prometheus 客户端库公开应用程序指标
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      使用集中式日志记录工具收集和持久化日志
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      使用分布式跟踪系统识别瓶颈
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="_1">运行高可用应用程序<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>您的客户希望您的应用程序始终可用,包括在您进行更改时,尤其是在流量激增时。可扩展和有弹性的架构可以使您的应用程序和服务在没有中断的情况下运行,从而保持用户满意。可扩展的基础设施根据业务需求进行扩展和收缩。消除单点故障是提高应用程序可用性和提高弹性的关键步骤。</p>
<p>使用 Kubernetes,您可以以高可用和有弹性的方式运行您的应用程序。它的声明式管理确保一旦您设置了应用程序,Kubernetes 将不断尝试<a href="https://kubernetes.io/docs/concepts/architecture/controller/#desired-vs-current">将当前状态与所需状态匹配</a>。</p>
<h2 id="_2">建议<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="pod">避免运行单个 Pod<a class="headerlink" href="#pod" title="Permanent link">&para;</a></h3>
<p>如果您的整个应用程序在单个 Pod 中运行,那么如果该 Pod 被终止,您的应用程序将无法使用。不要使用单个 Pod 部署应用程序,而是创建 <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployments</a>。如果 Deployment 创建的 Pod 失败或被终止,Deployment <a href="https://kubernetes.io/docs/concepts/architecture/controller/">控制器</a>将启动一个新的 Pod 以确保指定数量的副本 Pod 始终运行。</p>
<h3 id="_3">运行多个副本<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>使用 Deployment 运行应用程序的多个副本 Pod 可以以高可用的方式运行它。如果一个副本失败,其余副本仍将正常运行,尽管容量会有所降低,直到 Kubernetes 创建另一个 Pod 来弥补损失。此外,您可以使用 <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">Horizontal Pod Autoscaler</a> 根据工作负载需求自动扩展副本。</p>
<h3 id="_4">在节点上调度副本<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>如果所有副本都在同一个节点上运行,并且该节点变得不可用,运行多个副本就不会很有用。考虑使用 pod 反亲和性或 pod 拓扑传播约束将 Deployment 的副本分散到多个工作节点上。</p>
<p>您还可以通过跨多个可用区(AZ)运行应用程序来进一步提高典型应用程序的可靠性。</p>
<h4 id="pod_1">使用 Pod 反亲和性规则<a class="headerlink" href="#pod_1" title="Permanent link">&para;</a></h4>
<p>下面的清单告诉 Kubernetes 调度程序<em>首选</em>将 pod 放在不同的节点和 AZ 上。它不要求不同的节点或 AZ,因为如果这样做,一旦每个 AZ 都有一个 pod 在运行,Kubernetes 就无法再调度任何 pod。如果您的应用程序只需要三个副本,您可以对 <code>topologyKey: topology.kubernetes.io/zone</code> 使用 <code>requiredDuringSchedulingIgnoredDuringExecution</code>,Kubernetes 调度程序将不会在同一个 AZ 中调度两个 pod。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>apiVersion: apps/v1
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>kind: Deployment
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>metadata:
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>  name: spread-host-az
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  labels:
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    app: web-server
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>spec:
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>  replicas: 4
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>  selector:
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    matchLabels:
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>      app: web-server
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>  template:
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    metadata:
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>      labels:
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>        app: web-server
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    spec:
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>      affinity:
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>        podAntiAffinity:
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>          preferredDuringSchedulingIgnoredDuringExecution:
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>          - podAffinityTerm:
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>              labelSelector:
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>                matchExpressions:
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>                - key: app
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>                  operator: In
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>                  values:
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>                  - web-server
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>              topologyKey: topology.kubernetes.io/zone
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>            weight: 100
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>          - podAffinityTerm:
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>              labelSelector:
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>                matchExpressions:
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>                - key: app
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>                  operator: In
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>                  values:
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>                  - web-server
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>              topologyKey: kubernetes.io/hostname 
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>            weight: 99
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>      containers:
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>      - name: web-app
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>        image: nginx:1.16-alpine
</code></pre></div>
<h4 id="pod_2">使用 Pod 拓扑传播约束<a class="headerlink" href="#pod_2" title="Permanent link">&para;</a></h4>
<p>与 pod 反亲和性规则类似,pod 拓扑传播约束允许您在不同的故障(或拓扑)域(如主机或 AZ)中提供您的应用程序。当您试图确保容错性以及通过在不同的拓扑域中拥有多个副本来实现可用性时,这种方法效果很好。另一方面,pod 反亲和性规则很容易产生一个结果,即在一个拓扑域中只有一个副本,因为彼此具有反亲和性的 pod 会产生排斥效果。在这种情况下,在专用节点上只有一个副本既不利于容错性,也不是资源的有效利用。使用拓扑传播约束,您可以更好地控制调度程序应该在拓扑域之间尝试应用的传播或分布。以下是在此方法中使用的一些重要属性:
1. <code>maxSkew</code> 用于控制或确定跨拓扑域的最大不均衡程度。例如,如果一个应用程序有 10 个副本,并部署在 3 个 AZ 上,您无法实现均匀分布,但您可以影响分布的不均匀程度。在这种情况下,<code>maxSkew</code> 可以是 1 到 10 之间的任何值。值为 1 意味着您可能最终会得到类似 <code>4,3,3</code>、<code>3,4,3</code> 或 <code>3,3,4</code> 的分布。相比之下,值为 10 意味着您可能最终会得到类似 <code>10,0,0</code>、<code>0,10,0</code> 或 <code>0,0,10</code> 的分布。
2. <code>topologyKey</code> 是节点标签的一个键,定义了应该用于 pod 分布的拓扑域类型。例如,区域传播将具有以下键值对:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>topologyKey: &quot;topology.kubernetes.io/zone&quot;
</code></pre></div>
3. <code>whenUnsatisfiable</code> 属性用于确定如果无法满足所需的约束,您希望调度程序如何响应。
4. <code>labelSelector</code> 用于查找匹配的 pod,以便调度程序在根据您指定的约束决定将 pod 放在哪里时可以了解它们。</p>
<p>除了上述这些,您还可以阅读 <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/">Kubernetes 文档</a>中关于其他字段的更多信息。</p>
<p><img alt="跨 3 个 AZ 的 Pod 拓扑传播约束" src="../../../../reliability/docs/images/pod-topology-spread-constraints.jpg" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>apiVersion: apps/v1
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>kind: Deployment
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>metadata:
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>  name: spread-host-az
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>  labels:
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    app: web-server
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>spec:
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>  replicas: 10
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>  selector:
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    matchLabels:
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>      app: web-server
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>  template:
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    metadata:
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>      labels:
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>        app: web-server
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    spec:
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>      topologySpreadConstraints:
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>      - maxSkew: 1
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>        topologyKey: &quot;topology.kubernetes.io/zone&quot;
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>        whenUnsatisfiable: ScheduleAnyway
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>        labelSelector:
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>          matchLabels:
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>            app: express-test
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>      containers:
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>      - name: web-app
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>        image: nginx:1.16-alpine
</code></pre></div>
<h3 id="kubernetes-metrics-server">运行 Kubernetes Metrics Server<a class="headerlink" href="#kubernetes-metrics-server" title="Permanent link">&para;</a></h3>
<p>安装 Kubernetes <a href="https://github.com/kubernetes-sigs/metrics-server">metrics server</a> 来帮助扩展您的应用程序。Kubernetes 自动缩放器插件如 <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">HPA</a> 和 <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler">VPA</a> 需要跟踪应用程序的指标来对其进行扩展。metrics-server 收集可用于做出扩展决策的资源指标。这些指标是从 kubelet 收集的,并以 <a href="https://github.com/kubernetes/metrics">Metrics API 格式</a>提供。</p>
<p>metrics-server 不保留任何数据,它也不是一个监控解决方案。它的目的是向其他系统公开 CPU 和内存使用指标。如果您想跟踪应用程序随时间的状态,您需要一个监控工具,如 Prometheus 或 Amazon CloudWatch。</p>
<p>按照 <a href="https://docs.aws.amazon.com/eks/latest/userguide/metrics-server.html">EKS 文档</a>在您的 EKS 集群中安装 metrics-server。</p>
<h2 id="pod-hpa">水平 Pod 自动缩放器 (HPA)<a class="headerlink" href="#pod-hpa" title="Permanent link">&para;</a></h2>
<p>HPA 可以根据需求自动扩展您的应用程序,并帮助您在高峰流量期间避免影响您的客户。它作为 Kubernetes 中的一个控制循环实现,定期从提供资源指标的 API 查询指标。</p>
<p>HPA 可以从以下 API 检索指标:
1. <code>metrics.k8s.io</code> 也称为资源指标 API - 提供 pod 的 CPU 和内存使用情况
2. <code>custom.metrics.k8s.io</code> - 提供来自其他指标收集器(如 Prometheus)的指标;这些指标是 <strong>内部</strong> 于您的 Kubernetes 集群。 
3. <code>external.metrics.k8s.io</code> - 提供 <strong>外部</strong> 于您的 Kubernetes 集群的指标(例如,SQS 队列深度,ELB 延迟)。</p>
<p>您必须使用这三个 API 之一来提供用于扩展应用程序的指标。</p>
<h3 id="_5">根据自定义或外部指标扩展应用程序<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>您可以使用自定义或外部指标根据 CPU 或内存利用率以外的指标来扩展您的应用程序。<a href="https://github.com/kubernetes-sigs/custom-metrics-apiserver">自定义指标</a> API 服务器提供 <code>custom-metrics.k8s.io</code> API,HPA 可以使用它来自动扩展应用程序。</p>
<p>您可以使用 <a href="https://github.com/directxman12/k8s-prometheus-adapter">Prometheus Adapter for Kubernetes Metrics APIs</a> 从 Prometheus 收集指标并与 HPA 一起使用。在这种情况下,Prometheus 适配器将以 <a href="https://github.com/kubernetes/metrics/blob/master/pkg/apis/metrics/types.go">Metrics API 格式</a>公开 Prometheus 指标。</p>
<p>部署 Prometheus 适配器后,您可以使用 kubectl 查询自定义指标。
<code>kubectl get —raw /apis/custom.metrics.k8s.io/v1beta1/</code></p>
<p>外部指标顾名思义,为水平 Pod 自动缩放器提供了使用集群外指标扩展部署的能力。例如,在批处理工作负载中,通常会根据正在进行的作业数量来扩展副本数量。</p>
<p>要使用 CloudWatch 指标自动扩展 Deployment,例如,<a href="https://github.com/awslabs/k8s-cloudwatch-adapter/blob/master/samples/sqs/README.md">根据 SQS 队列深度扩展批处理处理器应用程序</a>,您可以使用 <a href="https://github.com/awslabs/k8s-cloudwatch-adapter"><code>k8s-cloudwatch-adapter</code></a>。<code>k8s-cloudwatch-adapter</code> 是一个社区项目,不由 AWS 维护。</p>
<h2 id="pod-vpa">垂直 Pod 自动缩放器 (VPA)<a class="headerlink" href="#pod-vpa" title="Permanent link">&para;</a></h2>
<p>VPA 自动调整 Pod 的 CPU 和内存预留,以帮助您"合理调整"应用程序的大小。对于需要垂直扩展的应用程序 - 通过增加资源分配来完成 - 您可以使用 <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler">VPA</a> 自动扩展 Pod 副本或提供扩展建议。</p>
<p>如果 VPA 需要扩展您的应用程序,您的应用程序可能会暂时不可用,因为 VPA 的当前实现不会执行对 Pod 的就地调整;相反,它将重新创建需要扩展的 Pod。</p>
<p><a href="https://docs.aws.amazon.com/eks/latest/userguide/vertical-pod-autoscaler.html">EKS 文档</a>包含设置 VPA 的演练。</p>
<p><a href="https://github.com/FairwindsOps/goldilocks/">Fairwinds Goldilocks</a> 项目提供了一个仪表板,用于可视化 VPA 对 CPU 和内存请求和限制的建议。它的 VPA 更新模式允许您根据 VPA 建议自动扩展 Pod。</p>
<h2 id="_6">更新应用程序<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>现代应用程序需要快速创新,同时具有高度的稳定性和可用性。Kubernetes 为您提供了工具,可以在不影响客户的情况下持续更新您的应用程序。</p>
<p>让我们看看一些最佳实践,使您能够快速部署更改而不牺牲可用性。</p>
<h3 id="_7">有一种回滚机制<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>有一个撤销按钮可以避免灾难。在将更新推送到生产集群之前,最佳做法是在单独的较低环境(测试或开发环境)中测试部署。使用 CI/CD 管道可以帮助您自动化和测试部署。使用持续部署管道,如果升级出现问题,您可以快速恢复到旧版本。</p>
<p>您可以使用 Deployments 来更新正在运行的应用程序。这通常通过更新容器镜像来完成。您可以使用 <code>kubectl</code> 像这样更新 Deployment:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>kubectl<span class="w"> </span>--record<span class="w"> </span>deployment.apps/nginx-deployment<span class="w"> </span><span class="nb">set</span><span class="w"> </span>image<span class="w"> </span>nginx-deployment<span class="w"> </span><span class="nv">nginx</span><span class="o">=</span>nginx:1.16.1
</code></pre></div>
<p><code>--record</code> 参数记录对 Deployment 的更改,如果您需要执行回滚,这将很有帮助。<code>kubectl rollout history deployment</code> 显示您集群中 Deployments 的记录更改。您可以使用 <code>kubectl rollout undo deployment &lt;DEPLOYMENT_NAME&gt;</code> 回滚更改。</p>
<p>默认情况下,当您更新需要重新创建 pod 的 Deployment 时,Deployment 将执行<a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/">滚动更新</a>。换句话说,Kubernetes 只会更新 Deployment 中正在运行的 pod 的一部分,而不是全部 Pod。您可以通过 <code>RollingUpdateStrategy</code> 属性控制 Kubernetes 执行滚动更新的方式。</p>
<p>在执行 Deployment 的<em>滚动更新</em>时,您可以使用 <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#max-unavailable"><code>Max Unavailable</code></a> 属性指定在更新期间最多可以有多少 Pod 不可用。Deployment 的 <code>Max Surge</code> 属性允许您设置可以超过所需 Pod 数量的最大 Pod 数。</p>
<p>考虑调整 <code>max unavailable</code> 以确保滚动部署不会影响您的客户。例如,Kubernetes 默认设置 25% 的 <code>max unavailable</code>,这意味着如果您有 100 个 Pod,在滚动部署期间可能只有 75 个 Pod 处于活动状态。如果您的应用程序需要至少 80 个 Pod,这个滚动部署可能会造成中断。相反,您可以将 <code>max unavailable</code> 设置为 20%,以确保在整个滚动部署过程中至少有 80 个功能性 Pod。</p>
<h3 id="_8">使用蓝/绿部署<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>变更本质上是有风险的,但无法撤销的变更可能是灾难性的。允许您有效"回到过去"的变更过程通过<em>回滚</em>使增强和试验更加安全。蓝/绿部署为您提供了一种快速撤回更改的方法。在这种部署策略中,您为新版本创建一个环境。这个环境与当前版本的应用程序完全相同。一旦新环境配置好,流量就会路由到新环境。如果新版本产生了预期的结果而没有产生错误,就会终止旧环境。否则,流量将恢复到旧版本。</p>
<p>您可以通过创建一个与现有版本的 Deployment 完全相同的新 Deployment 来在 Kubernetes 中执行蓝/绿部署。一旦您验证新 Deployment 中的 Pod 正在运行且没有错误,您就可以通过更改路由流量到您应用程序 Pod 的 Service 的 <code>selector</code> 规范来开始将流量发送到新 Deployment。</p>
<p>许多持续集成工具,如 <a href="https://fluxcd.io">Flux</a>、<a href="https://www.jenkins.io">Jenkins</a> 和 <a href="https://spinnaker.io">Spinnaker</a>,都允许您自动化蓝/绿部署。AWS Containers Blog 包含一个使用 AWS Load Balancer Controller 的演练:<a href="https://aws.amazon.com/blogs/containers/using-aws-load-balancer-controller-for-blue-green-deployment-canary-deployment-and-a-b-testing/">使用 AWS Load Balancer Controller 进行蓝/绿部署、金丝雀部署和 A/B 测试</a></p>
<h3 id="_9">使用金丝雀部署<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>金丝雀部署是蓝/绿部署的一种变体,可以大大降低变更的风险。在这种部署策略中,您会在旧 Deployment 旁边创建一个具有较少 Pod 的新 Deployment,并将少量流量转发到新 Deployment。如果指标表明新版本的性能与现有版本一样好或更好,您就会逐步增加流量到新 Deployment 并扩大它,直到所有流量都转发到新 Deployment。如果出现问题,您可以将所有流量路由回旧 Deployment,并停止向新 Deployment 发送流量。</p>
<p>尽管 Kubernetes 没有提供原生的金丝雀部署方式,但您可以使用诸如 <a href="https://github.com/weaveworks/flagger">Flagger</a> 与 <a href="https://docs.flagger.app/tutorials/istio-progressive-delivery">Istio</a> 或 <a href="https://docs.flagger.app/install/flagger-install-on-eks-appmesh">App Mesh</a> 之类的工具。</p>
<h2 id="_10">健康检查和自我修复<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>没有软件是无错误的,但 Kubernetes 可以帮助您最小化软件故障的影响。过去,如果应用程序崩溃,就需要有人手动修复这种情况,重新启动应用程序。Kubernetes 使您能够检测 Pod 中的软件故障,并自动用新的副本替换它们。有了 Kubernetes,您可以监控应用程序的健康状况,并自动替换不健康的实例。</p>
<p>Kubernetes 支持三种类型的<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">健康检查</a>:</p>
<ol>
<li>存活探针</li>
<li>启动探针(从 Kubernetes 版本 1.16+ 开始支持)</li>
<li>就绪探针</li>
</ol>
<p><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/">Kubelet</a>,Kubernetes 代理,负责运行所有上述检查。Kubelet 可以通过三种方式检查 Pod 的健康状况:kubelet 可以在 Pod 容器内运行 shell 命令,向其容器发送 HTTP GET 请求,或在指定端口上打开 TCP 套接字。</p>
<p>如果选择基于 <code>exec</code> 的探针,它在容器内运行 shell 脚本,请确保 shell 命令在 <code>timeoutSeconds</code> 值到期之前退出。否则,您的节点将有 <code>&lt;defunct&gt;</code> 进程,导致节点故障。</p>
<h2 id="_11">建议<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<h3 id="pod_3">使用存活探针删除不健康的 pod<a class="headerlink" href="#pod_3" title="Permanent link">&para;</a></h3>
<p>存活探针可以检测<em>死锁</em>条件,即进程继续运行但应用程序变得无响应。例如,如果您正在运行一个侦听端口 80 的 web 服务,您可以配置一个存活探针来向 Pod 的端口 80 发送 HTTP GET 请求。Kubelet 将定期向 Pod 发送 GET 请求并期望响应;如果 Pod 在 200-399 之间响应,则 kubelet 认为该 Pod 是健康的;否则,该 Pod 将被标记为不健康。如果 Pod 持续失败健康检查,kubelet 将终止它。</p>
<p>您可以使用 <code>initialDelaySeconds</code> 来延迟第一次探测。</p>
<p>使用存活探针时,请确保您的应用程序不会陷入所有 Pod 同时失败存活探针的情况,因为 Kubernetes 将尝试替换所有 Pod,这将导致您的应用程序离线。此外,Kubernetes 将继续创建新的 Pod,它们也会失败存活探针,给控制平面带来不必要的压力。避免将存活探针配置为依赖于 Pod 外部的因素,例如外部数据库。换句话说,对于不响应的外部于 Pod 的数据库,不应该导致您的 Pod 失败存活探针。</p>
<p>Sandor Szücs 的文章<a href="https://srcco.de/posts/kubernetes-liveness-probes-are-dangerous.html">存活探针很危险</a>描述了错误配置的探针可能造成的问题。</p>
<h3 id="_12">对于启动时间较长的应用程序,使用启动探针<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>当您的应用程序需要额外的启动时间时,您可以使用启动探针来延迟存活和就绪探针。例如,一个需要从数据库中加载缓存的 Java 应用程序可能需要长达两分钟的时间才能完全启动。在它完全启动之前,任何存活或就绪探针都可能失败。配置启动探针将允许 Java 应用程序在执行其他探针之前变为<em>健康</em>状态。</p>
<p>在启动探针成功之前,所有其他探针都是禁用的。您可以定义 Kubernetes 应该等待应用程序启动的最长时间。如果在最大配置时间后 Pod 仍然失败启动探针,它将被终止,并创建一个新的 Pod。</p>
<p>启动探针类似于存活探针 - 如果它们失败,Pod 将被重新创建。正如 Ricardo A. 在他的文章<a href="https://medium.com/swlh/fantastic-probes-and-how-to-configure-them-fef7e030bd2f">神奇的探针及其配置</a>中解释的那样,当应用程序的启动时间不可预测时,应该使用启动探针。如果您知道您的应用程序需要十秒钟来启动,您应该使用带有 <code>initialDelaySeconds</code> 的存活/就绪探针,而不是使用启动探针。</p>
<h3 id="_13">使用就绪探针检测部分不可用<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>虽然存活探针检测应用程序中可通过终止 Pod(因此重新启动应用程序)来解决的故障,但就绪探针检测应用程序可能<em>暂时</em>不可用的条件。在这些情况下,应用程序可能会暂时无法处理请求。</p>
<p>例如,在磁盘 I/O 操作期间,应用程序可能会暂时无法处理请求。在这里,终止应用程序的 Pod 不是一个补救措施;与此同时,发送到其 Pod 的其他请求也可能失败。</p>
<p>您可以使用就绪探针来检测应用程序的临时不可用,并在它再次变得可用之前停止向其发送流量。<em>与存活探针不同,如果就绪探针失败,结果将是 Pod 不会从 Kubernetes Service 接收任何流量,而不是 Pod 被重新创建。</em>当就绪探针成功时,Pod 将恢复从 Service 接收流量。</p>
<p>就像存活探针一样,避免配置依赖于 Pod 外部资源(如数据库)的就绪探针。这里有一个场景,一个配置不当的就绪探针可能会使应用程序失去功能 - 如果 Pod 的就绪探针在应用程序的数据库不可访问时失败,其他 Pod 副本也会同时失败,因为它们共享相同的健康检查标准。以这种方式设置探针将确保每当数据库不可用时,Pod 的就绪探针都会失败,Kubernetes 将停止向<em>所有</em> Pod 发送流量。</p>
<p>使用就绪探针的一个副作用是,它们可以增加更新 Deployment 所需的时间。新副本只有在就绪探针成功后才会接收流量;在此之前,旧副本将继续接收流量。</p>
<hr />
<h2 id="_14">处理中断<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>Pod 有有限的生命周期 - 即使您有长期运行的 Pod,在适当的时候终止 Pod 也是明智的。根据您的升级策略,Kubernetes 集群升级可能需要您创建新的工作节点,这需要在新节点上重新创建所有 Pod。适当的终止处理和 Pod 中断预算可以帮助您在从旧节点删除 Pod 并在新节点上重新创建它们时避免服务中断。</p>
<p>升级工作节点的首选方式是创建新的工作节点并终止旧节点。在终止工作节点之前,您应该<code>排空</code>它。当一个工作节点被排空时,它的所有 pod 都被<em>安全地</em>驱逐。安全是一个关键词;当 pod 从一个工作节点被驱逐时,它们不会简单地收到 <code>SIGKILL</code> 信号。相反,会向每个 Pod 中容器的主进程(PID 1)发送 <code>SIGTERM</code> 信号。发送 <code>SIGTERM</code> 信号后,Kubernetes 会给该进程一些时间(宽限期),然后再发送 <code>SIGKILL</code> 信号。默认宽限期为 30 秒;您可以通过在 kubectl 中使用 <code>grace-period</code> 标志或在 Podspec 中声明 <code>terminationGracePeriodSeconds</code> 来覆盖默认值。</p>
<p><code>kubectl delete pod &lt;pod name&gt; —grace-period=&lt;seconds&gt;</code></p>
<p>在容器中,主进程并不总是 PID 1。考虑这个基于 Python 的示例容器:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>$ kubectl exec python-app -it ps
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a> PID USER TIME COMMAND
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a> 1   root 0:00 {script.sh} /bin/sh ./script.sh
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a> 5   root 0:00 python app.py
</code></pre></div>
<p>在这个例子中,shell 脚本接收 <code>SIGTERM</code>,但 Python 应用程序作为主进程,没有收到 <code>SIGTERM</code> 信号。当 Pod 被终止时,Python 应用程序将被突然终止。这可以通过更改容器的 <a href="https://docs.docker.com/engine/reference/builder/#entrypoint"><code>ENTRYPOINT</code></a> 来启动 Python 应用程序来解决。或者,您可以使用像 <a href="https://github.com/Yelp/dumb-init">dumb-init</a> 这样的工具来确保您的应用程序可以处理信号。</p>
<p>您还可以使用 <a href="https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/#container-hooks">容器钩子</a> 在容器启动或停止时执行脚本或 HTTP 请求。<code>PreStop</code> 钩子操作在容器收到 <code>SIGTERM</code> 信号之前运行,并且必须在发送此信号之前完成。<code>terminationGracePeriodSeconds</code> 值从 <code>PreStop</code> 钩子操作开始执行时开始计算,而不是从发送 <code>SIGTERM</code> 信号时开始计算。</p>
<h2 id="_15">建议<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<h3 id="pod_4">使用 Pod 中断预算保护关键工作负载<a class="headerlink" href="#pod_4" title="Permanent link">&para;</a></h3>
<p>Pod 中断预算或 PDB 可以暂时阻止驱逐过程,如果应用程序的副本数量低于声明的阈值。一旦可用副本数量超过阈值,驱逐过程将继续。您可以使用 PDB 声明 <code>minAvailable</code> 和 <code>maxUnavailable</code> 副本数量。例如,如果您希望您的应用程序至少有三个副本可用,您可以创建一个 PDB。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>apiVersion: policy/v1beta1
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>kind: PodDisruptionBudget
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>metadata:
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>  name: my-svc-pdb
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>spec:
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>  minAvailable: 3
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>  selector:
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    matchLabels:
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>      app: my-svc
</code></pre></div>
<p>上述 PDB 策略告诉 Kubernetes 在三个或更多副本可用之前,暂停驱逐过程。节点排空会尊重 <code>PodDisruptionBudgets</code>。在 EKS 托管节点组升级期间,<a href="https://docs.aws.amazon.com/eks/latest/userguide/managed-node-update-behavior.html">节点以 15 分钟的超时时间排空</a>。15 分钟后,如果不强制更新(EKS 控制台中称为滚动更新),更新将失败。如果强制更新,则 pod 将被删除。</p>
<p>对于自管理节点,您还可以使用像 <a href="https://github.com/aws/aws-node-termination-handler">AWS Node Termination Handler</a> 这样的工具,它确保 Kubernetes 控制平面适当地响应可能导致您的 EC2 实例变得不可用的事件,例如 <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/monitoring-instances-status-check_sched.html">EC2 维护</a>事件和 <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/spot-interruptions.html">EC2 Spot 中断</a>。它使用 Kubernetes API 来隔离节点,以确保不会调度新的 Pod,然后对其进行排空,终止任何正在运行的 Pod。</p>
<p>您可以使用 Pod 反亲和性来调度 Deployment 的 Pod 在不同的节点上,以避免节点升级期间 PDB 相关的延迟。</p>
<h3 id="_16">实践混沌工程<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<blockquote>
<p>混沌工程是在分布式系统上进行实验的学科,以建立对系统在动荡条件下的能力的信心。</p>
</blockquote>
<p>在他的博客中,Dominik Tornow 解释说,<a href="https://medium.com/@dominik.tornow/the-mechanics-of-kubernetes-ac8112eaa302">Kubernetes 是一个声明式系统</a>,其中"<em>用户向系统提供所需状态的表示。系统然后考虑当前状态和所需状态,以确定从当前状态过渡到所需状态的一系列命令。</em>"这意味着 Kubernetes 始终存储<em>所需状态</em>,如果系统偏离,Kubernetes 将采取行动来恢复状态。例如,如果一个工作节点变得不可用,Kubernetes 将重新调度 Pod 到另一个工作节点。同样,如果一个 <code>replica</code> 崩溃,<a href="https://kubernetes.io/docs/concepts/architecture/controller/#design">Deployment 控制器</a>将创建一个新的 <code>replica</code>。通过这种方式,Kubernetes 控制器会自动修复故障。</p>
<p>混沌工程工具,如 <a href="https://www.gremlin.com">Gremlin</a>,可帮助您测试 Kubernetes 集群的弹性,并识别单点故障。引入人为混沌的工具可以揭示系统性的弱点,提供识别瓶颈和错误配置的机会,并在受控环境中纠正问题。混沌工程哲学倡导有目的地破坏事物,并对基础设施进行压力测试,以最小化意外停机。</p>
<h3 id="_17">使用服务网格<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>您可以使用服务网格来提高应用程序的可靠性。服务网格可以实现服务到服务的通信,并增加微服务网络的可观察性。大多数服务网格产品都通过在每个服务旁运行一个小型网络代理来工作,该代理拦截和检查应用程序的网络流量。您可以在不修改应用程序的情况下将应用程序放入网格中。使用服务代理内置的功能,您可以生成网络统计信息、创建访问日志,并为分布式跟踪添加 HTTP 头。</p>
<p>服务网格可以通过自动重试请求、设置超时、断路和限流等功能,帮助您使微服务更加可靠。</p>
<p>如果您运营多个集群,您可以使用服务网格实现跨集群的服务到服务通信。</p>
<h3 id="_18">服务网格<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://aws.amazon.com/app-mesh/">AWS App Mesh</a></li>
<li><a href="https://istio.io">Istio</a></li>
<li><a href="http://linkerd.io">LinkerD</a></li>
<li><a href="https://www.consul.io">Consul</a></li>
</ul>
<hr />
<h2 id="_19">可观察性<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h2>
<p>可观察性是一个包括监控、日志记录和跟踪的总称。基于微服务的应用程序本质上是分布式的。与监控单一系统足够的单体应用程序不同,在分布式应用程序架构中,您需要监控每个组件的性能。您可以使用集群级监控、日志记录和分布式跟踪系统来识别集群中的问题,从而在它们影响您的客户之前解决问题。</p>
<p>Kubernetes 内置的故障排除和监控工具有限。metrics-server 收集资源指标并将它们存储在内存中,但不持久化它们。您可以使用 kubectl 查看 Pod 的日志,但 Kubernetes 不会自动保留日志。分布式跟踪的实现是在应用程序代码级别完成的,或者使用服务网格。</p>
<p>Kubernetes 的可扩展性在这里发挥作用。Kubernetes 允许您引入您首选的集中式监控、日志记录和跟踪解决方案。</p>
<h2 id="_20">建议<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h2>
<h3 id="_21">监控您的应用程序<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p>现代应用程序需要监控的指标数量不断增加。如果您有一种自动跟踪应用程序的方法,这将很有帮助,这样您就可以专注于解决客户的挑战。集群范围的监控工具,如 <a href="https://prometheus.io">Prometheus</a> 或 <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html">CloudWatch Container Insights</a>,可以监控您的集群和工作负载,并在事情出错(最好是在事情变糟之前)时为您提供信号。</p>
<p>监控工具允许您创建警报,您的运营团队可以订阅这些警报。考虑制定规则来激活可能导致停机或影响应用程序性能的事件的警报。</p>
<p>如果您不确定应该监控哪些指标,您可以从这些方法中获取灵感:</p>
<ul>
<li><a href="https://www.weave.works/blog/a-practical-guide-from-instrumenting-code-to-specifying-alerts-with-the-red-method">RED 方法</a>。代表请求、错误和持续时间。</li>
<li><a href="http://www.brendangregg.com/usemethod.html">USE 方法</a>。代表利用率、饱和度和错误。</li>
</ul>
<p>Sysdig 的文章<a href="https://sysdig.com/blog/alerting-kubernetes/">Kubernetes 上的最佳警报实践</a>包含了可能影响应用程序可用性的组件的全面列表。</p>
<h3 id="prometheus">使用 Prometheus 客户端库公开应用程序指标<a class="headerlink" href="#prometheus" title="Permanent link">&para;</a></h3>
<p>除了监控应用程序的状态和聚合标准指标外,您还可以使用 <a href="https://prometheus.io/docs/instrumenting/clientlibs/">Prometheus 客户端库</a>公开应用程序特定的自定义指标,以提高应用程序的可观察性。</p>
<h3 id="_22">使用集中式日志记录工具收集和持久化日志<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p>EKS 中的日志记录分为两类:控制平面日志和应用程序日志。EKS 控制平面日志直接从控制平面提供审核和诊断日志到您帐户中的 CloudWatch Logs。应用程序日志是 Pod 内部生成的日志。应用程序日志包括运行业务逻辑应用程序的 Pod 以及 CoreDNS、Cluster Autoscaler、Prometheus 等 Kubernetes 系统组件生成的日志。</p>
<p><a href="https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html">EKS 提供五种类型的控制平面日志</a>:</p>
<ol>
<li>Kubernetes API 服务器组件日志</li>
<li>审计</li>
<li>认证器</li>
<li>控制器管理器</li>
<li>调度器</li>
</ol>
<p>控制器管理器和调度器日志可以帮助诊断控制平面问题,如瓶颈和错误。默认情况下,EKS 控制平面日志不会发送到 CloudWatch Logs。您可以启用控制平面日志记录,并为您帐户中的每个集群选择要捕获的 EKS 控制平面日志类型。</p>
<p>收集应用程序日志需要在集群中安装日志聚合工具,如 <a href="http://fluentbit.io">Fluent Bit</a>、<a href="https://www.fluentd.org">Fluentd</a> 或 <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/deploy-container-insights-EKS.html">CloudWatch Container Insights</a>。</p>
<p>Kubernetes 日志聚合工具作为 DaemonSet 运行,并从节点中收集容器日志。然后,应用程序日志被发送到集中式目的地进行存储。例如,CloudWatch Container Insights 可以使用 Fluent Bit 或 Fluentd 收集日志并将其发送到 CloudWatch Logs 进行存储。Fluent Bit 和 Fluentd 支持许多流行的日志分析系统,如 Elasticsearch 和 InfluxDB,让您可以通过修改 Fluent bit 或 Fluentd 的日志配置来更改日志的存储后端。</p>
<h3 id="_23">使用分布式跟踪系统识别瓶颈<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p>典型的现代应用程序的组件分布在网络上,其可靠性取决于构成应用程序的每个组件的正常运行。您可以使用分布式跟踪解决方案来了解请求的流向以及系统之间的通信方式。跟踪可以显示应用程序网络中存在的瓶颈,并防止可能导致级联故障的问题。</p>
<p>您有两种选择来实现应用程序的跟踪:您可以在代码级别实现分布式跟踪,使用共享库,或者使用服务网格。</p>
<p>在代码级别实现跟踪可能是不利的。在这种方法中,您必须对代码进行更改。如果您有多语言应用程序,这会更加复杂。您还需要维护另一个库,跨您的服务。</p>
<p>像 <a href="http://linkerd.io">LinkerD</a>、<a href="http://istio.io">Istio</a> 和 <a href="https://aws.amazon.com/app-mesh/">AWS App Mesh</a> 这样的服务网格可以在不对应用程序代码进行大量更改的情况下实现分布式跟踪。您可以使用服务网格来标准化指标生成、日志记录和跟踪。</p>
<p>跟踪工具,如 <a href="https://aws.amazon.com/xray/">AWS X-Ray</a> 和 <a href="https://www.jaegertracing.io">Jaeger</a>,支持共享库和服务网格实现。</p>
<p>考虑使用像 <a href="https://aws.amazon.com/xray/">AWS X-Ray</a> 或 <a href="https://www.jaegertracing.io">Jaeger</a> 这样的跟踪工具,它们支持两种(共享库和服务网格)实现,这样如果您后来采用服务网格,您就不需要切换工具。</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["tabs", "content.code.copy", "announce.dismiss", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.bd41221c.min.js"></script>
      
    
  </body>
</html>